{"ts":1377460392519,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"setgame.game = (function () {\r\n    var game = {};\r\n\r\n    game.startDailyGame = function (userName) {\r\n        if (setgame.viewModel.currentTab() === 'practice') {\r\n            game.start();\r\n        }\r\n        else if (userName == null || userName === '') {\r\n            setgame.viewModel.login(true);\r\n        }\r\n        else {\r\n            setgame.viewModel.login(false);\r\n            game.start();\r\n        }\r\n    }\r\n\r\n    game.start = function () {\r\n\r\n        var isPractice = setgame.viewModel.currentTab() === 'practice';\r\n        Math.seedrandom(isPractice ? Date.now() : setgame.viewModel.seed());\r\n\r\n        setgame.viewModel.gameState('loading');\r\n        setgame.viewModel.gameState('started');\r\n        setgame.engine.initializeBoard();\r\n        setgame.viewModel.startTime(new Date().getTime());\r\n    }\r\n\r\n    game.getTodaysSeed = function () {\r\n        // Caclulate offset milliseconds, so we can use local time\r\n        var offset = new Date().getTimezoneOffset() * 1000 * 60;\r\n        var today = Math.floor((Date.now() - offset) / 1000 / 60 / 60 / 24);\r\n        \r\n        $.ajax({\r\n            url: 'api/Game/GetDailySeed/' + today,\r\n            dataType: 'json',\r\n            success: function (seed) {\r\n                Math.seedrandom(seed);\r\n                setgame.viewModel.seed(seed);\r\n                setgame.viewModel.LeaderboardVM.getAllGames();\r\n\r\n                ko.applyBindings(setgame.viewModel);\r\n\r\n                $('.demo-3').hide('fast', function () {\r\n                    $('.container-narrow').show('slow', function () {\r\n                    });\r\n                });\r\n\r\n\r\n\r\n            }\r\n        });\r\n    }\r\n\r\n    game.checkIfValidSet = function (set) {\r\n\r\n        if (setgame.engine.isValidSet(set[0], set[1], set[2])) {\r\n            if (setgame.game.isUnique(set)) {\r\n                setgame.viewModel.foundSets.push(set);\r\n            }\r\n            else {\r\n                alert(\"Already found\");\r\n            }\r\n        }\r\n        else {\r\n            alert('Not valid set');\r\n        }\r\n\r\n\r\n        if (setgame.viewModel.foundSets().length === 6) {\r\n            game.winning();\r\n        }\r\n\r\n\r\n        game.clearSelection();\r\n    }\r\n\r\n    game.winning = function () {\r\n        var score = (new Date().getTime() - setgame.viewModel.startTime()) / 1000.0;\r\n        setgame.viewModel.score(score);\r\n        setgame.viewModel.gameState('winning');\r\n\r\n        var wasPractice = setgame.viewModel.currentTab() === 'practice';\r\n        setgame.viewModel.wasPractice(wasPractice);\r\n\r\n        setgame.viewModel.currentTab('stats');\r\n\r\n        if (!wasPractice) {\r\n            console.error(\"Fix this ajax\");\r\n            $.ajax({\r\n                url: 'api/Game/Completed?userName=' + setgame.helpers.GetUserName() + \"&score=\" + score + \"&seed=\" + setgame.viewModel.seed(),\r\n                dataType: 'json',\r\n                success: function () {\r\n                    getStats(GetUserName());\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    game.isUnique = function (set) {\r\n        var foundSets = setgame.viewModel.foundSets();\r\n\r\n        var fileNames = [];\r\n        for (var i in foundSets) {\r\n            fileNames.push($.map(foundSets[i], function (val) {\r\n                return val.fileName;\r\n            }).sort());\r\n        }\r\n\r\n        var curSetFileNames = $.map(set, function (val, i) {\r\n            return val.fileName;\r\n        }).sort();\r\n\r\n\r\n        for (var i in fileNames) {\r\n            if (fileNames[i][0] === curSetFileNames[0] &&\r\n                fileNames[i][1] === curSetFileNames[1] &&\r\n                fileNames[i][2] === curSetFileNames[2]) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n\r\n    game.practiceMeow = function () {\r\n        setgame.viewModel.currentTab('practice');\r\n        setgame.viewModel.board([]);\r\n        setgame.viewModel.foundSets([]);\r\n        setgame.game.start();\r\n    }\r\n\r\n    game.clearSelection = function () {\r\n\r\n        setgame.viewModel.selections = ko.observableArray();\r\n\r\n        for (var i = 0; i < setgame.viewModel.board().length; i++) {\r\n            for (var j = 0; j < setgame.viewModel.board()[i].length; j++) {\r\n                setgame.viewModel.board()[i][j].isSelected(false);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    game.getStats = function (userName) {\r\n        console.error(\"Fix this ajax\");\r\n        $.ajax({\r\n            url: 'api/Game/GetAllGames',\r\n            dataType: 'json',\r\n            success: function (games) {\r\n                setgame.viewModel.allGames(games);\r\n            }\r\n        });\r\n    }\r\n\r\n    return game;\r\n}());\r\n\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":4616}]],"length":4616}
